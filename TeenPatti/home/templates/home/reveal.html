{% extends "home/base.html" %}

{% block content %}
<head>
    <title>Game Results</title>
</head>
<body>
  <h2>Game Results</h2>

  evaluated = []
for p in players:
    rank_num, card_vals, rank_name = evaluate_hand(p.card)
    score = sum(card_vals)
    p.score = score
    p.total_score += score
    p.save()
    evaluated.append((p, rank_num, card_vals, rank_name))

# Determine winner
winner_player, *_ = max(
    evaluated,
    key=lambda x: (-x[1], x[2])
)

<ul>
  {% for player, rank_num, card_vals, rank_name in evaluated %}
    <li>
      {% if player == winner %}
        ğŸ† <strong>{{ player }}</strong>: {{ rank_name }} ({{ player.card }}) â€“ Score: {{ player.score }}
      {% else %}
        âŒ {{ player }}: {{ rank_name }} ({{ player.card }}) â€“ Score: {{ player.score }}
      {% endif %}
    </li>
  {% endfor %}
</ul>


  <h3>ğŸ† Winner: {% if winner.is_bot %}ğŸ¤– Bot{% else %}ğŸ§‘ You{% endif %}</h3>

  <br>

  <div style="margin-top: 20px;">
    <!-- ğŸ” Play Again Button -->
    <a href="/start/{{ winner.room.room_code }}/">
      <button style="padding: 10px 20px; font-size: 16px;">ğŸ” Play Again</button>
    </a>

    <!-- ğŸ§¹ Reset Score Button -->
    <a href="/reset/{{ winner.room.room_code }}/" style="margin-left: 10px;">
      <button style="padding: 10px 20px; font-size: 16px;">ğŸ§¹ Reset Scores</button>
    </a>

    <!-- ğŸ  Back to Lobby -->
    <a href="/lobby/" style="margin-left: 10px;">
      <button style="padding: 10px 20px; font-size: 16px;">ğŸ  Back to Lobby</button>
    </a>
  </div>
</body>
{% endblock %}
